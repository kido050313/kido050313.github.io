<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>kido</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-09-29T02:51:17.619Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>kido</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>小程序实现批量删除，全选，取消全选功能的一些总结</title>
    <link href="http://yoursite.com/2018/09/03/my-first-blog/"/>
    <id>http://yoursite.com/2018/09/03/my-first-blog/</id>
    <published>2018-09-03T10:12:54.000Z</published>
    <updated>2018-09-29T02:51:17.619Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p> &emsp;&emsp;最近有一个小程序需求是批量删除，全选和取消全选，这次记录一下这次遇到的问题。</p><p> &emsp;&emsp;一开始打算用小程序的组建checkbox实现的，但是之后发现checkbox的<font color="red">checked属性是单向绑定不支持双向绑定</font>，我在实现全选和取消功能时候需要在js中更改checked的值，在文档中没有明确的说明checked是单向的，最后在社区的官方回答中找到了这个。自己回过头又仔细看了<a href="https://developers.weixin.qq.com/miniprogram/dev/component/checkbox.html" title="checkbox文档" target="_blank" rel="noopener">文档</a>果然用了“设置默认选中”说明了，也有可能我太菜了所以没看出来，不管怎么样，最后我换成了view。  </p><p> &emsp;&emsp;这次实现的逻辑：<br> &emsp;&emsp;1. 点击编辑弹出全选+取消全选按钮，编辑按钮变成不可点击的删除按钮，同时每条记录前有选择按钮；<br> &emsp;&emsp;2. 点击全选所有的选项都是选中状态，点击取消则全不选中；<br> &emsp;&emsp;3. 单选时，没有选中的话就是点击就是选中，item.checked为true控制页面选中样式，反之item.checked= false时为取消选中状态；<br> &emsp;&emsp;4. 如果全选状态下，列表中某一项取消选中，全选样式改变；<br> &emsp;&emsp;5. 点击删除将选中记录的id数组传给后台进行删除。  </p><p> &emsp;&emsp; </p><ul><li><p><strong>js文件中data数据如下：</strong>  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">data: &#123;</span><br><span class="line">  isFooter: false,</span><br><span class="line">  doneHistory: true,</span><br><span class="line">  flagHistory: true,</span><br><span class="line">  hidden: false, </span><br><span class="line">  icon: &quot;../../images/icon/Shape3.png&quot;,</span><br><span class="line">  removeIndex: [],      </span><br><span class="line">  removeHistoryId: [], </span><br><span class="line">  historyList: [],</span><br><span class="line">  loading: false,</span><br><span class="line">  isHeader: true, //选框状态</span><br><span class="line">  isClick: true, //删除按钮</span><br><span class="line">  isChoose: true, //是否选中</span><br><span class="line">  isChecked: false,//全选状态</span><br><span class="line">  deleteNum: &apos;&apos;, //删除个数</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;</p></li><li><p><strong>在通过修改item.checked为true控制页面选中样式时，遇到了数组中的checked属性无法进行<font color="red">实时刷新</font>，最后参考了一些文章找到了方法.</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var itemIndex = e.target.dataset.index;//当前点击的下标</span><br><span class="line">var newChecked = &apos;historyList[&apos; + itemIndex + &apos;].checked&apos;; //重点，拼成字符串</span><br><span class="line">   that.setData(&#123;</span><br><span class="line">     [newChecked]: !that.data.historyList[itemIndex].checked //用中括号括起来即可</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure><p>参考文档：<a href="https://blog.csdn.net/stp_zsj/article/details/81979669" target="_blank" rel="noopener">https://blog.csdn.net/stp_zsj/article/details/81979669</a><br>&emsp;&emsp; &emsp;&emsp;&ensp;<a href="https://www.cnblogs.com/simuhunluo/p/7989461.html" target="_blank" rel="noopener">https://www.cnblogs.com/simuhunluo/p/7989461.html</a><br>&emsp;&emsp; </p><ul><li><strong>使用splice()通过删除被选中项的下标实现删除功能</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var _reIndex = that.data.removeIndex;</span><br><span class="line">          for (var i = 0; i &lt; _reIndex.length;i++)&#123;</span><br><span class="line">            var _index = _reIndex[i];</span><br><span class="line">            console.log(_index)   </span><br><span class="line">            that.data.historyList.splice(_index, 1);</span><br><span class="line">          &#125;</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            historyList: that.data.historyList,</span><br><span class="line">            isChoose: true,</span><br><span class="line">            removeHistoryId: [],</span><br><span class="line">            removeIndex: [],</span><br><span class="line">            deleteNum: &apos;&apos;,</span><br><span class="line">            isHeader: true,</span><br><span class="line">            isClick: true,</span><br><span class="line">            isDelete: true,</span><br><span class="line">          &#125;);</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>&emsp;&emsp;其他的都挺简单的，主要是自己的做的时候把自己绕晕了，还有就是光想是不够的还要动手实践了才行。最后放出丑丑效果图  </p><center><image src="my-first-blog/q1.png"></image></center><br>—<br><br><center>最后20：35了，赶紧跑……</center>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="小程序" scheme="http://yoursite.com/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
    
      <category term="小程序" scheme="http://yoursite.com/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
</feed>
